---
import Head from "../components/HeadSEO.astro";
import CeritaImmersion from "../components/homepage/Slideshow/ImageSlideshow.astro";
import BaseLayout from "../layouts/BaseLayout.astro";

// Vueコンポーネントをインポート
import Navbar from "../components/Navbar.vue";
import Hero from "../components/homepage/hero.astro";
import InvitationModal from "../components/InvitationModal.vue";

// CSSをインポート
import "../styles/global.css";
import "../styles/homepage/ImageSlideshow.css";
import "../styles/homepage/index.css";

// 画像をインポート
import homepageOgImage from "../assets/images/Logo Discord.png";
---

<!doctype html>
<html lang="id">
  <head>
    <Head
      title="Komunitas Immersion Terbesar JP-Indonesia"
      description="Komunitas immersion bahasa Jepang terbesar Indonesia. Belajar alami, kuasai seperti penutur asli."
      ogImage={homepageOgImage}
      pageType="website"
      publishedDate="2025/08/10"
      lang="id"
    />
    <!-- DNS Prefetch for "CeritaImmersio" -->
    <link
      rel="preload"
      href="/img/SlideshowHomepage/Slide-post-0.webp"
      as="image"
      type="image/webp"
    />
    <link
      rel="preload"
      href="/img/SlideshowHomepage/Slide-post-1.webp"
      as="image"
      type="image/webp"
    />
    <link
      rel="preload"
      href="/img/SlideshowHomepage/Slide-post-2.webp"
      as="image"
      type="image/webp"
    />
    <link
      rel="preload"
      href="/img/SlideshowHomepage/Slide-post-3.webp"
      as="image"
      type="image/webp"
    />
    <link
      rel="preload"
      href="/img/SlideshowHomepage/Slide-post-4.webp"
      as="image"
      type="image/webp"
    />
    <link
      rel="preload"
      href="/img/SlideshowHomepage/Slide-post-5.webp"
      as="image"
      type="image/webp"
    />

    <!-- Prefetch non-critical resources (Enhanced) -->
    <link rel="prefetch" href="/docs/posts" />
    <link rel="prefetch" href="/discord" />
    <link rel="prefetch" href="/docs/post" />
  </head>
  <body>
    <!-- Stylesheet -->
    <link rel="stylesheet" href="/css/homepage-styles.css" />
    <!-- Wave Animation Background (Hidden from screen readers) -->
    <canvas id="waveCanvas" class="wave-canvas" aria-hidden="true"></canvas>

    <!-- Stars Background (Hidden from screen readers) -->
    <div class="stars" aria-hidden="true">
      <div class="star" style="top: 10%; left: 20%; animation-delay: 0s;"></div>
      <div class="star" style="top: 20%; right: 20%; animation-delay: 1s;">
      </div>
      <div class="star" style="top: 30%; left: 80%; animation-delay: 2s;"></div>
      <div class="star" style="bottom: 30%; left: 10%; animation-delay: 1.5s;">
      </div>
      <div class="star" style="bottom: 20%; right: 30%; animation-delay: 0.5s;">
      </div>
      <div class="star" style="top: 60%; left: 15%; animation-delay: 2.5s;">
      </div>
      <div class="star" style="top: 80%; right: 20%; animation-delay: 1.8s;">
      </div>
      <div class="star" style="bottom: 40%; right: 60%; animation-delay: 0.8s;">
      </div>
    </div>

    <!-- Navigation -->
    <Navbar client:visible />

    <!-- Main Content -->
    <main class="main-content" role="main" transition:name="main-content">
      <!-- Hero Section -->
      <Hero
        missionId="mission"
        invitationModalId="invitationModal"
        titleLine1="Belajar Secara Alami,"
        titleLine2="Kuasai Layaknya Penutur Asli."
      />

      <!-- Add the ImageSlideshow component here -->
      <div
        class="mb-8 flex flex-col items-center justify-center min-h-auto w-full loading"
        transition:name="slideshow-section"
        data-lazy
      >
        <CeritaImmersion />
      </div>

      <!-- Mission Section -->
      <section
        id="mission"
        class="mission-section smooth-edge-bottom loading"
        aria-labelledby="mission-title"
        transition:name="mission-section"
        data-lazy
      >
        <div class="mission-container">
          <h2
            class="mission-title"
            id="mission-title"
            transition:name="mission-title"
          >
            Misi Kami
          </h2>
          <div class="mission-content">
            <div class="mission-text">
              <p>
                🌊✨ <b>Misi kami adalah memberi jalur yang menyenangkan</b>,
                dan <i>terbukti secara ilmiah</i> oleh 🎓 Prof. Stephen Krashen bagi
                siapa pun yang mulai dari <b>nol</b> untuk menguasai bahasa Jepang
                secara alami 🌱 dan berkelanjutan.
              </p>
              <p>
                Kami yakin belajar bahasa itu bukan sekadar menghafal aturan 📖
                atau kosakata, tapi membentuk kemampuan berpikir, 🤔 memahami,
                dan berkomunikasi seperti penutur asli. Dengan immersion, kamu
                langsung terjun dalam bahasa Jepang sejak hari
                pertama—mendengar, membaca, dan ⚡ langsung memahaminya di
                konteks aslinya.
              </p>
              <p>
                🚀 Kami hadir untuk menghapus rasa takut dan kebingungan pemula.
                🗺️ Roadmap kami memecah perjalanan menjadi tahap sederhana—dari
                huruf dasar (kana) hingga memahami novel, percakapan, dan media
                kompleks—dengan dukungan tools seperti Anki, kamus monolingual,
                dan konten Jepang yang sesuai level-mu.
              </p>
              <p>
                🎯🔥 <b>Tujuan akhir kami</b> adalah membuat-mu "hidup" dalam bahasa
                Jepang, bukan sekadar mempelajarinya. Kami ingin kamu mencapai titik
                di mana bahasa Jepang tidak lagi diterjemahkan di kepala, tetapi
                ⚡ dipahami secara instan seperti bahasa ibu. Dengan immersion, kamu
                tidak hanya mempelajari aturan, tetapi membangun hubungan yang mendalam
                dengan 🎎 budaya, pola pikir, dan ekspresi unik orang Jepang. Ini
                adalah perjalanan menuju <i>Nativeness</i> 💫, bukan sekadar <i
                  >Fluency</i
                >—dan kami akan menemani setiap langkahmu 👣.
              </p>
            </div>
          </div>
          <div class="mission-cta">
            <button
              class="cta-button"
              onclick="openInvitationModal()"
              aria-label="Bergabung dengan komunitas GoRakuDo"
              transition:name="cta-button"
            >
              Gabung Komunitas Kami
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <path d="M5 12h14M12 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>
        </div>
      </section>

      <!-- Features Section -->
      <section
        class="features-section loading"
        aria-labelledby="features-title"
        transition:name="features-section"
        data-lazy
      >
        <div class="features-container">
          <h2
            class="features-title"
            id="features-title"
            transition:name="features-title"
          >
            Pendekatan Immersion
          </h2>
          <div class="features-grid" role="list">
            <article
              class="feature-card"
              role="listitem"
              transition:name="feature-card-1"
            >
              <div class="feature-icon" aria-hidden="true">⚡</div>
              <h3>Adaptive Learning</h3>
              <p>
                Rekomendasi yang didukung oleh Metodologi SLA (Ilmu Pembelajaran
                Bahasa ke-2) terbaru yang sesuai cara otak dirancang untuk
                memperoleh bahasa—melalui paparan bermakna, bukan sekedar
                hafalan.
              </p>
            </article>
            <article
              class="feature-card"
              role="listitem"
              transition:name="feature-card-2"
            >
              <div class="feature-icon" aria-hidden="true">👥</div>
              <h3>Belajar Bersama Komunitas</h3>
              <p>
                Bergabunglah dengan sesama pembelajar dan penutur asli dalam
                lingkungan komunitas yang mendukung.
              </p>
            </article>
            <article
              class="feature-card"
              role="listitem"
              transition:name="feature-card-3"
            >
              <div class="feature-icon" aria-hidden="true">📚</div>
              <h3>Peta Jalan Terstruktur</h3>
              <p>
                Tahapan yang jelas dan dapat dicapai dari kana dasar hingga
                media kompleks. Setiap langkah dibangun secara alami dari yang
                sebelumnya.
              </p>
            </article>
            <article
              class="feature-card"
              role="listitem"
              transition:name="feature-card-4"
            >
              <div class="feature-icon" aria-hidden="true">🧠</div>
              <h3>Berpikir dalam Jepang</h3>
              <p>
                Melampaui terjemahan. Kembangkan kemampuan untuk memahami dan
                merasakan bahasa Jepang secara instan, seperti penutur asli.
              </p>
            </article>
          </div>
        </div>
      </section>

      <!-- Documentation Preview Section -->
      <section
        class="docs-preview-section loading"
        aria-labelledby="docs-title"
        transition:name="docs-section"
        data-lazy
      >
        <div class="docs-container">
          <h2 class="docs-title" id="docs-title" transition:name="docs-title">
            Panduan & Dokumentasi
          </h2>
          <p class="docs-description">
            Akses panduan lengkap, metodologi immersion, dan sumber daya
            pembelajaran yang telah terbukti efektif.
          </p>
          <div class="docs-cta">
            <button
              class="docs-button"
              onclick="goToPosts()"
              aria-label="Lihat semua dokumentasi dan panduan"
              transition:name="docs-button"
            >
              Lihat Dokumentasi
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <path d="M5 12h14M12 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>
        </div>
      </section>
    </main>

    <!-- Invitation Modal - Load only when needed -->
    <InvitationModal client:idle />

    <script is:inline src="/scripts/hompage-script.js"></script>

    <!-- Bundle Splitting: Load performance monitoring as separate chunk -->
    <script>
      // Load performance monitoring after page load for better performance
      window.addEventListener("load", () => {
        // Dynamic import for performance monitoring (separate chunk)
        import("../utils/performance-monitor.js")
          .then((module) => {
            module.initPerformanceMonitoring();
          })
          .catch((error) => {
            console.log(
              "📊 Performance monitoring failed to load:",
              error.message
            );
          });
      });

      // Intersection Observer for lazy loading optimization
      const lazyElements = document.querySelectorAll("[data-lazy]");
      const lazyObserver = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("loaded");
            lazyObserver.unobserve(entry.target);
          }
        });
      });

      lazyElements.forEach((el) => lazyObserver.observe(el));

      // Service Worker registration for caching (if available)
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          // Opt-in only: enable by setting localStorage.setItem('enable-sw','true')
          const enableSW = localStorage.getItem("enable-sw") === "true";

          if (enableSW) {
            navigator.serviceWorker
              .register("/sw.js")
              .then((registration) => {
                console.log(
                  "🔧 Service Worker registered:",
                  registration.scope
                );

                // Check for updates
                registration.addEventListener("updatefound", () => {
                  const installing = registration.installing;
                  if (!installing) return;
                  installing.addEventListener("statechange", () => {
                    if (
                      installing.state === "installed" &&
                      navigator.serviceWorker.controller
                    ) {
                      console.log("🔄 New Service Worker available");
                    }
                  });
                });
              })
              .catch((error) => {
                console.log(
                  "⚠️ Service Worker registration failed:",
                  error?.message || error
                );
              });
          } else {
            // Disabled by default to avoid GH Pages cache/stale-content issues
            console.log(
              "🔧 Service Worker disabled (enable via localStorage 'enable-sw' = 'true')"
            );
          }
        });
      }
    </script>
  </body>
</html>
